<!DOCTYPE html>

<html>
<head>
  <title>franky.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>franky.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*!
 * Franky JavaScript Library v1.0.1
 *
 * (c) 2013-2014 Kondrat Shmoylov
 * Franky may be freely distributed under the MIT license.
 * For all details and documentation:
 * github.com/ikondrat/franky
 *
 * Date: 2014-12-10T16:03Z
 */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(global, factory)</span> </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> === <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span>.exports === <span class="hljs-string">"object"</span> ) {
        <span class="hljs-built_in">module</span>.exports = factory(global);
    } <span class="hljs-keyword">else</span> {
        factory(global);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Pass this if global is not defined yet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>}(<span class="hljs-keyword">typeof</span> global !== <span class="hljs-string">"undefined"</span> ? global : <span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( global )</span> </span>{
    <span class="hljs-keyword">var</span> franky = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(smth)</span> </span>{};
    
    franky.version = <span class="hljs-string">"1.0.1"</span>;
    franky.isDebug = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Array test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.isArray = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> /**<span class="hljs-title">Boolean</span>*/ </span>{
        <span class="hljs-keyword">return</span> (item <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Array-like structure test E.g.: <code>arguments</code> <code>collection</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.isArrayLike = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> </span>{
        <span class="hljs-keyword">return</span> (franky.isObject(item) &amp;&amp; !franky.isArray(item) &amp;&amp; <span class="hljs-string">"length"</span> <span class="hljs-keyword">in</span> item);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Checks for element is HTMLElement</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.isElement = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Object*/</span>obj)</span> /**<span class="hljs-title">Boolean</span>*/ </span>{
        <span class="hljs-keyword">try</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Using W3 DOM2 (works for FF, Opera and Chrom)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> obj <span class="hljs-keyword">instanceof</span> HTMLElement;
        }
        <span class="hljs-keyword">catch</span>(e){</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Browsers not supporting W3 DOM2 don’t have HTMLElement and
an exception is thrown and we end up here. Testing some
properties that all elements have. (works on IE7)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> obj===<span class="hljs-string">"object"</span>) &amp;&amp;
                (obj.nodeType===<span class="hljs-number">1</span>) &amp;&amp; (<span class="hljs-keyword">typeof</span> obj.style === <span class="hljs-string">"object"</span>) &amp;&amp;
                (<span class="hljs-keyword">typeof</span> obj.ownerDocument ===<span class="hljs-string">"object"</span>);
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Function test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.isFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> /**<span class="hljs-title">Boolean</span>*/ </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.prototype.every.call(
            <span class="hljs-built_in">arguments</span>,
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> </span>{ <span class="hljs-keyword">return</span> x <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Function</span>;}
        );
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Object test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.isObject = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> /**<span class="hljs-title">Boolean</span>*/ </span>{
        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"object"</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Object test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.prototype.every.call(
            <span class="hljs-built_in">arguments</span>,
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">"string"</span>;}
        );
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Formats string with pattern as first argument and values as other ones.</p>
<blockquote>
<p>var res = franky.stringf(‘%s %s’, ‘hello’, ‘world’)
res === ‘hello world’</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.stringf = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>pattern, <span class="hljs-comment">/**String=*/</span>value)</span> /**<span class="hljs-title">String</span>*/ </span>{

        <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);

        <span class="hljs-keyword">return</span> pattern.replace(<span class="hljs-regexp">/%s/g</span>,
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{ <span class="hljs-keyword">return</span> args.shift()||<span class="hljs-string">""</span>; });
    };


    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">JSON</span> === <span class="hljs-string">"undefined"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"JSON is not supported"</span>);
    }
    franky.JSON = <span class="hljs-built_in">JSON</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Logging utilities</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.console = {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>formated log with pattern</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        slog: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(pattern)</span> </span>{
            <span class="hljs-keyword">this</span>.log( franky.stringf.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>) );
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>plain log</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        log: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(smth)</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> debug !== <span class="hljs-string">"undefined"</span>) {
                debug(smth);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (global.console &amp;&amp; global.console.log) {
                global.console.log(smth);
            }
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>error report with available stdout</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        error: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(txt)</span> </span>{
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(txt);
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>detailed log</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dir: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(smth)</span> </span>{
            <span class="hljs-keyword">this</span>.log(franky.JSON.stringify(smth));
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Log something in console</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.log = franky.console.log;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Report about error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.error = franky.console.error;


    <span class="hljs-keyword">var</span> URLre = <span class="hljs-regexp">/^https?:\/\/\S+/i</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>check string is URL</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.isURL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>str)</span> /**<span class="hljs-title">Boolean</span>*/ </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> str !== <span class="hljs-string">"string"</span>) {
            franky.error(<span class="hljs-string">"isURL expects string parameter instead "</span> + <span class="hljs-keyword">typeof</span> str);
        }

        <span class="hljs-keyword">return</span> URLre.test(str);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Use filter pollyfill or existed function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> arrFilter = <span class="hljs-built_in">Array</span>.prototype.filter ?
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(arr, callback)</span> </span>{
            <span class="hljs-keyword">return</span> arr.filter(callback);
        } :
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(arr, callback)</span> </span>{
            <span class="hljs-keyword">var</span> res = [];

            franky.each(arr, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item, i)</span> </span>{
                <span class="hljs-keyword">if</span> (callback(item, i, <span class="hljs-keyword">this</span>)) {
                    res.push(item);
                }
            });

            <span class="hljs-keyword">return</span> res;
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Select all items that pass a truth test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.filter = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Array*/</span>arr, <span class="hljs-comment">/**Function*/</span>callback)</span> /**<span class="hljs-title">Array</span>*/ </span>{
        <span class="hljs-keyword">if</span> (!franky.isArray(arr)) {
            franky.error(
                    <span class="hljs-string">'first argument is expected to be an array instead of '</span> + <span class="hljs-keyword">typeof</span> arr
            );
        }
        <span class="hljs-keyword">if</span> (!franky.isFunction(callback)) {
            franky.error(
                    <span class="hljs-string">'second argument is expected to be a function instead of '</span> + <span class="hljs-keyword">typeof</span> callback
            );
        }
        <span class="hljs-keyword">return</span> arrFilter(arr, callback);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Iterates through every array item with callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.forEach = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Array*/</span>arr, <span class="hljs-comment">/**Function*/</span>callback, <span class="hljs-comment">/**Object*/</span>contextArr)</span> /**<span class="hljs-title">Object</span>*/ </span>{
        <span class="hljs-keyword">var</span> i, l;
        contextArr = contextArr || arr;
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, l = arr.length; i &lt; l; i++) {
            callback.call(contextArr, arr[i], i, arr);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Dispatch for accessor <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf">Array.indexOf</a>
Searches index of item in <code>arr</code> with declared <code>value</code> and from position in array setted  in <code>startFromIndex</code>, by default - 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.indexOf = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Array*/</span>arr, <span class="hljs-comment">/**String*/</span>value, <span class="hljs-comment">/**Number=0*/</span>startFromIndex)</span> /**<span class="hljs-title">Number</span>*/</span>{
        startFromIndex = startFromIndex || <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (!(arr <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Function expects array as first argument"</span>);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"indexOf"</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">Array</span>.prototype) {
            <span class="hljs-keyword">return</span> arr.indexOf(value, startFromIndex);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = arr.length; i &lt; l; i++) {
                <span class="hljs-keyword">if</span> (arr[i] === value &amp;&amp; i &gt;= startFromIndex) {
                    <span class="hljs-keyword">return</span> i;
                }
            }
        }

        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Return the results of applying the callback to array item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.map = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Array*/</span>arr, <span class="hljs-comment">/**Function*/</span>callback)</span> /**<span class="hljs-title">Array</span>*/ </span>{
        <span class="hljs-keyword">var</span> res = [];
        <span class="hljs-keyword">if</span> (franky.isArray(arr) &amp;&amp; callback <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Function</span>) {
            res = arr.map(callback);
        }
        <span class="hljs-keyword">return</span> res;
    };


    (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>array some pollyfill</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> arrSome = <span class="hljs-built_in">Array</span>.prototype.some ?
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(arr, callback)</span> </span>{
                <span class="hljs-keyword">return</span> arr.some(callback);
            } :
            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(arr, callback)</span> </span>{
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = arr.length; i &lt; l; i++) {
                    <span class="hljs-keyword">if</span> (callback(arr[i], i, arr)) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                    }
                }
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Check if at least one item in array matches a truth test.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        franky.some = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Array*/</span>arr, <span class="hljs-comment">/**Function*/</span>callback)</span> /**<span class="hljs-title">Boolean</span>*/ </span>{
            <span class="hljs-keyword">if</span> (!franky.isArray(arr)) {
                franky.error(
                        <span class="hljs-string">'first argument is expected to be an array instead of '</span> + <span class="hljs-keyword">typeof</span> arr
                );
            }

            <span class="hljs-keyword">if</span> (!franky.isFunction(callback)) {
                franky.error(
                        <span class="hljs-string">'second argument is expected to be a function instead of '</span> + <span class="hljs-keyword">typeof</span> callback
                );
            }

            <span class="hljs-keyword">return</span> arrSome(arr, callback);

        };
    }());


    <span class="hljs-keyword">var</span> objFacade = {};

    franky.each = objFacade.each = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Object*/</span>obj, <span class="hljs-comment">/**Function*/</span>callback, <span class="hljs-comment">/**Object*/</span>contextObj)</span> /**<span class="hljs-title">Object</span>*/ </span>{
        <span class="hljs-keyword">if</span> (franky.isArray(obj)) {
            franky.forEach.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> item;
            contextObj = contextObj || obj;

            <span class="hljs-keyword">for</span> (item <span class="hljs-keyword">in</span> obj) {
                <span class="hljs-keyword">if</span> (obj.hasOwnProperty(item)) {
                    callback.call(contextObj, obj[item], item, obj);
                }
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Create object with base object linked as prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.beget = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Object*/</span>baseObj, <span class="hljs-comment">/**Object*/</span>newObjectProperties)</span> /**<span class="hljs-title">Object</span>*/</span>{
        <span class="hljs-keyword">var</span> res = {},
            obj,
            typeBase = <span class="hljs-keyword">typeof</span> baseObj,
            typeProperties = <span class="hljs-keyword">typeof</span> newObjectProperties;

        <span class="hljs-keyword">if</span> (typeBase !== <span class="hljs-string">"object"</span>) {
            franky.error(<span class="hljs-string">"Only object allowed to be prototype and tried to work with "</span> + typeBase);
        }
        <span class="hljs-keyword">if</span> (typeProperties !== <span class="hljs-string">"undefined"</span> &amp;&amp; typeProperties !== <span class="hljs-string">"object"</span>) {
            franky.error(<span class="hljs-string">"Only object allowed to be list of properties instead "</span> + typeProperties);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Object</span>.create === <span class="hljs-string">"function"</span>) {
            obj = {};

            franky.each(newObjectProperties, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, key)</span> </span>{
                obj[key]= {writable:<span class="hljs-literal">true</span>, enumerable: <span class="hljs-literal">true</span>, <span class="hljs-string">"value"</span>: value};
            });

            res = <span class="hljs-built_in">Object</span>.create(baseObj, obj);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> F = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>check if base Object exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (baseObj &amp;&amp; <span class="hljs-keyword">typeof</span> baseObj === <span class="hljs-string">"object"</span>) {
                F.prototype = baseObj;
            }
            obj = <span class="hljs-keyword">new</span> F();

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newObjectProperties !== <span class="hljs-string">"undefined"</span>) {
                franky.each(newObjectProperties, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item, i)</span> </span>{
                    obj[i] = item;
                });
            }
            res = obj;
        }

        <span class="hljs-keyword">return</span> res;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Generate random value in range from 0 to specified <code>count</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.getRandom = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Number=*/</span>count)</span> /**<span class="hljs-title">Number</span>*/ </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(<span class="hljs-built_in">Math</span>.random() * (count || <span class="hljs-number">1000</span>));
    };


    franky.getElementId = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node)</span> </span>{
        <span class="hljs-keyword">if</span> (!franky.isElement(node)) {
            franky.error(<span class="hljs-string">'nodeElement expected as first argument instead of '</span> + <span class="hljs-keyword">typeof</span> node);
        }

        <span class="hljs-keyword">var</span> id = node.getAttribute(<span class="hljs-string">'id'</span>);
        <span class="hljs-keyword">if</span> (!id) {
            id = <span class="hljs-string">'_'</span> + franky.getRandom(<span class="hljs-number">1e16</span>);
            node.setAttribute(<span class="hljs-string">'id'</span>, id);
        }
        <span class="hljs-keyword">return</span> id;
    };



    <span class="hljs-keyword">var</span> getElementsByAttrFallback = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> </span>{
        franky.log(<span class="hljs-string">"fallback"</span>);
        <span class="hljs-keyword">var</span> all = <span class="hljs-built_in">document</span>.all,
            res = [];

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = all.length; i &lt; len; ++i) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> all[i].getAttribute(attr) === <span class="hljs-string">'string'</span>) {
                res.push(all[i]);
            }
        }

        <span class="hljs-keyword">return</span> res;
    };

    franky.getElementsByAttr = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(attr)</span> </span>{
        <span class="hljs-keyword">var</span> res = [],
            contextNode = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] || global.document || <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'getAttribute'</span> <span class="hljs-keyword">in</span> contextNode &amp;&amp; contextNode.getAttribute(attr)) {
            res.push(contextNode);
        }
        <span class="hljs-keyword">if</span> (contextNode &amp;&amp; contextNode.querySelectorAll) {
            <span class="hljs-keyword">try</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>safari 5: querySelectorAll returns function-like array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                res = res.concat(<span class="hljs-built_in">Array</span>.prototype.slice.call(contextNode.querySelectorAll(<span class="hljs-string">'['</span> + attr + <span class="hljs-string">']'</span>)));
            } <span class="hljs-keyword">catch</span> (e) {}
        }
        <span class="hljs-keyword">if</span> (!res.length) {
            res = res.concat(getElementsByAttrFallback(attr));
        }

        <span class="hljs-keyword">return</span> res;
    };


    <span class="hljs-keyword">var</span> trimRe = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>()).compile(<span class="hljs-regexp">/^\s+|\s+$/g</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Replaces empty spaces from start and end of string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.trim = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>str)</span> /**<span class="hljs-title">String</span>*/ </span>{
        <span class="hljs-keyword">var</span> paramsType = <span class="hljs-keyword">typeof</span> str;
        <span class="hljs-keyword">if</span> (paramsType !== <span class="hljs-string">'string'</span>) {
            franky.error(<span class="hljs-string">'Argument must be string but'</span> + paramsType + <span class="hljs-string">' passed'</span>);
        }
        <span class="hljs-keyword">return</span> str.trim <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Function</span> ?
            str.trim() :
            str.replace(trimRe, <span class="hljs-string">''</span>);
    };


    franky.stripSpaces = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(str)</span> </span>{
        <span class="hljs-keyword">return</span> str.split(<span class="hljs-string">" "</span>).join(<span class="hljs-string">""</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Gets value from object by path</p>
<blockquote>
<p>var a = {x: {a: 1}}; x.getJPathValue(a, ‘x.1’) -&gt; 1</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.getJPathValue = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(<span class="hljs-comment">/**Object*/</span>smth, <span class="hljs-comment">/**String*/</span>key)</span> </span>{
        <span class="hljs-keyword">var</span> c = smth,
            keys = key.split(<span class="hljs-string">"."</span>),
            i = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">while</span>(c[keys[i]]) {
            c = c[keys[i++]];
        }

        <span class="hljs-keyword">return</span> c;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Creates object with <code>beget</code> property</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.getObject = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> </span>{
        obj.beget = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(values)</span> </span>{
            <span class="hljs-keyword">return</span> franky.beget(<span class="hljs-keyword">this</span>, values);
        };
        <span class="hljs-keyword">return</span> franky.beget(obj);
    };


    franky.create = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj)</span> </span>{

        <span class="hljs-keyword">var</span> F = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{};
        F.prototype = obj;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> F();
    };


    <span class="hljs-comment">/**
     * Appends query parameters to specified URI
     * @param {String} url    URI for append query
     * @param {Object} params Query params by key:value
     *
     * @returns {String} URI with inserted query parameters
     */</span>
    franky.constructURL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(url, params)</span> </span>{
        <span class="hljs-keyword">var</span> res = <span class="hljs-string">""</span>,
            query = [],
            item,
            items = url.match(<span class="hljs-regexp">/((?:https?\:)?(?:\/)?\/[^?]+)\?([^#]+)?(\#\S+)?/</span>),
            hashValue = items &amp;&amp; items[<span class="hljs-number">3</span>] ? items[<span class="hljs-number">3</span>] : <span class="hljs-string">""</span>;

        <span class="hljs-keyword">if</span> (items &amp;&amp; items[<span class="hljs-number">2</span>]) {
            <span class="hljs-keyword">var</span> cquery = items[<span class="hljs-number">2</span>].split(<span class="hljs-string">"&amp;"</span>),
                i = cquery.length;

            <span class="hljs-keyword">while</span> (i--) {
                query.push(cquery[i]);
            }
        }
        <span class="hljs-keyword">for</span> (item <span class="hljs-keyword">in</span> params) {
            <span class="hljs-keyword">if</span> (params.hasOwnProperty(item)) {
                query.push(item + <span class="hljs-string">"="</span> + params[item]);
            }
        }

        <span class="hljs-keyword">if</span> (items) {

            res = items[<span class="hljs-number">1</span>] + <span class="hljs-string">"?"</span> + query.join(<span class="hljs-string">"&amp;"</span>) + hashValue;
        } <span class="hljs-keyword">else</span> {
            res = url + <span class="hljs-string">"?"</span> + query.join(<span class="hljs-string">"&amp;"</span>) + hashValue;
        }

        <span class="hljs-keyword">return</span> res;
    };



    franky.data = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(node, dataName)</span> </span>{
        <span class="hljs-keyword">if</span> (!franky.isElement(node)) {
            franky.error(<span class="hljs-string">"nodeElement expected as first argument instead of "</span> + <span class="hljs-keyword">typeof</span> node);
        }
        <span class="hljs-keyword">return</span> node.getAttribute(<span class="hljs-string">"data-"</span> + dataName);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2 id="component-module">Component Module</h2>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Component’s base methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.ComponentBase = {</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Gets data by key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        data: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>name)</span> /**<span class="hljs-title">String</span>*/ </span>{
            <span class="hljs-keyword">var</span> el = <span class="hljs-keyword">this</span>.element;
            <span class="hljs-keyword">return</span> el ? franky.data(el, name) : <span class="hljs-literal">undefined</span>;
        },
        setId: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id)</span> </span>{
            <span class="hljs-keyword">this</span>.id = id;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },
        baseInit: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id, element)</span> </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">this</span>.element = element;
            franky.each(franky.dataset(element), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, key)</span> </span>{
                self[key] = value;
            });
        }
    };

    franky.Component = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> components = [],
            services = [],
            componentsIndex = {},
            appAttr = <span class="hljs-string">'data-xapp'</span>;

        <span class="hljs-keyword">return</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Cornerstone of Component moodule - method for creating new components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            extend: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(componentDescription)</span> </span>{
                <span class="hljs-keyword">var</span> i = components.length,
                    app;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Old-school declaration</p>
<blockquote>
<p>franky.Component.extend({
 id: ‘hello’,
 init: function () {
     console.log(‘hello’);
 }
});</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (franky.isObject(componentDescription)) {
                    app = franky.beget(franky.ComponentBase, componentDescription);</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Short form declaration</p>
<blockquote>
<p>franky.Component.extend(‘hello’, function () {
     console.log(‘hello’);
});</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (franky.isString(componentDescription) &amp;&amp; franky.isFunction(<span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>])) {
                    app = franky.beget(franky.ComponentBase, {
                        id: componentDescription,
                        init: <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>]
                    });</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Dependencies injection form declaration</p>
<blockquote>
<p>franky.Component.extend(‘hello’, [‘$logger’, function ($hello) {
     $logger.say(‘hello’);
}]);</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (franky.isString(componentDescription) &amp;&amp; franky.isArray(<span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>])) {
                    <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
                    app = franky.beget(franky.ComponentBase, {
                        id: componentDescription,
                        init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                            <span class="hljs-keyword">var</span> deps = franky.filter(args, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> </span>{
                                <span class="hljs-keyword">return</span> franky.isString(item);
                            });
                            deps = franky.map(deps, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(serviceName)</span> </span>{
                                <span class="hljs-keyword">if</span> (!services[serviceName]) {
                                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Service '</span> + serviceName + <span class="hljs-string">' hasnt defined'</span>);
                                }
                                <span class="hljs-keyword">return</span> services[serviceName]();
                            });
                            <span class="hljs-keyword">var</span> defs = franky.filter(args, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> </span>{

                                <span class="hljs-keyword">return</span> franky.isFunction(item);
                            });
                            <span class="hljs-keyword">if</span> (defs.length &gt; <span class="hljs-number">1</span>) {
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Too much declaration functions'</span>);
                            }
                            defs[<span class="hljs-number">0</span>].apply(<span class="hljs-keyword">this</span>, deps);
                        }
                    });
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Unknown definition structure, try to use extend("yourName", function() { ... init code ... })'</span>);
                }

                <span class="hljs-keyword">if</span> (!app.id) {
                    franky.error(<span class="hljs-string">'extend method expects id field in description object'</span>);
                }

                components.push(app);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>fill index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                componentsIndex[app.id] = i;
                <span class="hljs-keyword">return</span> components[i];

            },</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Declares service with name and function</p>
<blockquote>
<p>franky.Component.factory(‘ololo’, function () {
     var api = {
         getOlolo: function () {
             return ‘ololo’;
         }
     }
     return api;
});</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>            factory: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>name, <span class="hljs-comment">/**Function*/</span>factoryFunction)</span> </span>{
                services[name] = factoryFunction;

            },</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>We can init Component module by HTML.
E.g. <code>&lt;div data-xapp=&#39;test&#39;&gt;&lt;/div&gt;</code>
All components must be defined by data-xapp attributes for being inited</p>
<blockquote>
<p>E.g. <code>&lt;div data-xapp=&#39;test&#39;&gt;&lt;/div&gt;</code>
Then franky.Component.initByHTML can be called and all assigned components are being called by <code>init</code> function
<code>document.addEventListener( &#39;DOMContentLoaded&#39;, function () {
  franky.Component.initByHTML()
})</code></p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-string">'initByHTML'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Element*/</span>context)</span> </span>{
                <span class="hljs-keyword">var</span> contextNode = context || <span class="hljs-built_in">document</span>,
                    self = <span class="hljs-keyword">this</span>,
                    apps = franky.getElementsByAttr(appAttr, contextNode);

                franky.forEach(apps, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(element)</span> </span>{
                    <span class="hljs-keyword">var</span> names = franky.data(element, <span class="hljs-string">'xapp'</span>);
                    franky.forEach(names.split(<span class="hljs-string">' '</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(appName)</span> </span>{
                        self.initById(
                            appName,
                            franky.getElementId(element),
                            element
                        );
                    });
                });

                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            },
            <span class="hljs-string">'initById'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(name, elementId, appElement)</span> </span>{
                <span class="hljs-keyword">var</span> app = name <span class="hljs-keyword">in</span> componentsIndex ?
                    components[componentsIndex[name]] : <span class="hljs-literal">null</span>;

                <span class="hljs-keyword">if</span> (app) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> elementId !== <span class="hljs-string">'undefined'</span>) {
                        app.setId(elementId);
                    }
                    app.baseInit(elementId, appElement);
                    app.init(elementId);
                }
            }
        };

    })();</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>We may fetch all data-* values.
For docFragment as <code>&#39;&lt;div data-var1=&quot;hello&quot; data-var2=&quot;world&quot;&gt;&lt;/div&gt;&#39;</code></p>
<blockquote>
<p>x.datatset(docFragment).var1 -&gt; ‘hello’
x.datatset(docFragment).var2 -&gt; ‘world’</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.dataset = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Element*/</span>element)</span> /**<span class="hljs-title">Object</span>*/ </span>{
        <span class="hljs-keyword">var</span> res = {};
        <span class="hljs-keyword">if</span> (franky.isElement(element)) {
            <span class="hljs-keyword">if</span> (element.dataset) {
                res = element.dataset;
            } <span class="hljs-keyword">else</span> {
                franky.forEach(element.attributes, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> </span>{
                    <span class="hljs-keyword">if</span> (item.name.indexOf(<span class="hljs-string">"data-"</span>) === <span class="hljs-number">0</span>) {
                        res[item.name.substr(<span class="hljs-number">5</span>)] = item.value;
                    }
                });
            }
        }
        <span class="hljs-keyword">return</span> res;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Extends function by another function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.extend = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Function*/</span>subClass, <span class="hljs-comment">/**Function*/</span>superClass)</span> </span>{
        <span class="hljs-keyword">var</span> F = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{};
        subClass.superclass = F.prototype = superClass.prototype;
        subClass.prototype = <span class="hljs-keyword">new</span> F();
        subClass.prototype.constructor = subClass;

        <span class="hljs-keyword">if</span>(superClass.prototype.constructor === <span class="hljs-built_in">Object</span>.prototype.constructor) {
            superClass.prototype.constructor = superClass;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Creates interface description</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.Interface = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>name, <span class="hljs-comment">/**Array*/</span>methods)</span> </span>{
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length !== <span class="hljs-number">2</span>) {
            franky.error (
                    <span class="hljs-string">'Interface constructor called with '</span>+ <span class="hljs-built_in">arguments</span>.length +
                    <span class="hljs-string">'parameters, but expected exactly 2'</span>);
        }

        <span class="hljs-keyword">this</span>.methods = [];
        <span class="hljs-keyword">this</span>.name = name;

        franky.forEach(methods, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(method)</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> method !== <span class="hljs-string">'string'</span>) {
                franky.error(<span class="hljs-string">'Interface constructor expects method '</span>+
                    <span class="hljs-string">'names to be passed in as a string'</span>);
            }

            self.methods.push(method);
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Checks implementation of interface of interfaces for particular object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.Interface.ensureImplements = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Object*/</span>object, <span class="hljs-comment">/**Array*/</span>interfaces)</span> /**<span class="hljs-title">Boolean</span>*/ </span>{

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length !== <span class="hljs-number">2</span>) {
            franky.error (
                    <span class="hljs-string">'Interface constructor called with '</span>+ <span class="hljs-built_in">arguments</span>.length +
                    <span class="hljs-string">'parameters, but expected at least 2'</span>);
        }

        franky.forEach(interfaces, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(interfaceItem)</span> </span>{
            <span class="hljs-keyword">if</span> (interfaceItem.constructor !== franky.Interface) {
                franky.error(<span class="hljs-string">'Function Interface.ensureImplements expects arguments two and above to be instances of Interface.'</span>);
            }

            franky.forEach(interfaceItem.methods, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(method)</span> </span>{
                <span class="hljs-keyword">if</span> (!object[method] || <span class="hljs-keyword">typeof</span> object[method] !== <span class="hljs-string">'function'</span>) {
                    franky.error(<span class="hljs-string">'Function Interface.ensureImplements: object '</span>+
                        <span class="hljs-string">'does not implement the '</span> + interfaceItem.name +
                        <span class="hljs-string">' interface. Method '</span> + method + <span class="hljs-string">' was not found.'</span>);
                }
            });
        });

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <h2 id="view-module">View Module</h2>

            </div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>base constructor for view</p>
<blockquote>
<p>var myViews = franky.View();
myViews.let(‘hello’, ‘hello’);
It can be based on existed view instance it’s optional
var uberView = franky.View(myViews)</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.View = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Object*/</span>view)</span> </span>{
        <span class="hljs-keyword">this</span>.templates = view &amp;&amp; view.templates ?
            franky.beget(view.templates) :
        {};
    };

    franky.isString = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.prototype.every.call(
            <span class="hljs-built_in">arguments</span>,
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">"string"</span>;}
        );
    };

    franky.View.prototype = {
        templates: {},

        re: {
            <span class="hljs-string">"parse"</span> : <span class="hljs-regexp">/\[\%\s+([^%]+)\s+\%\]/g</span>,
            <span class="hljs-string">"rule"</span>: <span class="hljs-regexp">/:/</span>
        },

        setParseRe: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(re)</span> </span>{
            <span class="hljs-keyword">this</span>.re.parse = re;
        },

        getCustomRender: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> def = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] !== <span class="hljs-string">"undefined"</span> ?
                <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>].split(<span class="hljs-keyword">this</span>.re.rule) :
                <span class="hljs-literal">null</span>;

            <span class="hljs-keyword">if</span> (def &amp;&amp; def.length === <span class="hljs-number">2</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.parseRules[def[<span class="hljs-number">0</span>]] &amp;&amp; <span class="hljs-keyword">this</span>.parseRules[def[<span class="hljs-number">0</span>]].call(<span class="hljs-keyword">this</span>, def[<span class="hljs-number">1</span>]);
            }
        },

        parseRules: {
            l10n: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span></span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{
                    <span class="hljs-keyword">if</span> (franky.isDebug &amp;&amp; !d.l10n(key)) {
                        franky.console.error(<span class="hljs-string">"There is no translation for "</span> + key);
                    }
                    <span class="hljs-keyword">return</span> d.l10n ? d.l10n(key) : key;
                };
            },

            jpath: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span> </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{
                    <span class="hljs-keyword">return</span> franky.getJPathValue(d, key) || <span class="hljs-string">""</span>;
                };
            },

            view: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key)</span> </span>{
                <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{
                    <span class="hljs-keyword">return</span> self.get(key, d);
                };
            }
        },

        ruleFunction: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(paramName, defaults, superTemplates)</span> </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getCustomRender(paramName) || <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(d)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Get value from <code>data</code> or from described <code>views</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">var</span> res = d &amp;&amp; d[paramName] ||
                    (d &amp;&amp; d.views &amp;&amp; d.views.get(paramName, d)) || <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>If result is still empty try to reach other resources</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (!res) {</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>first - try to walk through superTemplates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    res =  superTemplates[paramName] ?
                        self.getContent(superTemplates[paramName], d) :</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>or get values from described defaults in template declaration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        defaults ? defaults[paramName] : <span class="hljs-string">""</span>;
                }
                <span class="hljs-keyword">if</span> (franky.isDebug &amp;&amp; !res) {
                    franky.console.log(
                            <span class="hljs-string">"Undefined variable "</span> + paramName
                    );
                }
                <span class="hljs-keyword">return</span> res || <span class="hljs-string">""</span>;
            };
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Returns processed string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        getContent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Array|Object*/</span>tmpl, <span class="hljs-comment">/**Object*/</span>data)</span> /**<span class="hljs-title">String</span>*/</span>{
            <span class="hljs-keyword">var</span> res= <span class="hljs-string">""</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>there are thre possible declarations array of functions, string and function
array case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (franky.isArray(tmpl)) {
                res = franky.map(tmpl, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(item)</span> </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"string"</span> ?
                        item:
                        item(data);
                }).join(<span class="hljs-string">""</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>function case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (franky.isFunction(tmpl)) {
                res = tmpl(data);</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>default string case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            } <span class="hljs-keyword">else</span> {
                res = tmpl.toString();
            }

            <span class="hljs-keyword">return</span> res;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Gets transformed value by defined template and data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-string">"get"</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>name, <span class="hljs-comment">/**Object*/</span>data)</span> /**<span class="hljs-title">String</span>*/ </span>{
            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            <span class="hljs-keyword">var</span> template = data &amp;&amp; data.views ?
                data.views.templates[name] : <span class="hljs-keyword">this</span>.templates[name];
            <span class="hljs-keyword">return</span> self.getContent(template, data);
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Declares template with name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.View.prototype.let = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>name, <span class="hljs-comment">/**String|Function*/</span>template, <span class="hljs-comment">/**Object*/</span>defaults)</span> /**<span class="hljs-title">Object</span>*/ </span>{

        <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">this</span>.templates[name] = [],
            self = <span class="hljs-keyword">this</span>,
            i = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">if</span> (franky.isFunction(template)) {
            result.push(template);
        } <span class="hljs-keyword">else</span> {
            template.replace(<span class="hljs-keyword">this</span>.re.parse, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(matchedExpression, matchedKey, matchedIndex)</span> </span>{
                result.push(
                    template.substr(i, matchedIndex - i),
                    self.ruleFunction(matchedKey, defaults, self.templates)
                );
                i = matchedIndex + matchedExpression.length;
            });
            <span class="hljs-keyword">if</span> (i &lt; template.length) {
                result.push(template.substr(i));
            }
        }


        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>We have default instanced view for manipulations</p>
<blockquote>
<p>franky.views.let(‘say’, ‘hello {{someone}}’)
franky.views.get(‘say’, {someone: “john”}) -&gt; ‘hello john’</p>
</blockquote>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.views = <span class="hljs-keyword">new</span> franky.View();</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Converts object-like structures to array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.toArray = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Object*/</span>smth)</span> /**<span class="hljs-title">Array</span>*/ </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.prototype.slice.call(smth);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>микромодуль для модульного написания кода</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> libs = {},
        cached = {};
    franky.amd = {</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>определяем модуль, по дефолту считаем что будем кешировать порожденную фабрику и по сути делать синглтон
e.g. franky.amd.define(‘myCarFactory’, function () { return {serial: 123}; })</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        define: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>id, <span class="hljs-comment">/**Function*/</span>lib, <span class="hljs-comment">/**Boolean*/</span> runOnce)</span> /**<span class="hljs-title">Object</span>*/</span>{
            runOnce = runOnce || <span class="hljs-literal">true</span>;
            libs[id] = lib;
            <span class="hljs-keyword">if</span> (runOnce) {
                cached[id] = <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Обрабатывает зависимости и выполняет callback функцию в случае удовлетворения всех зависимостей
e.g. franky.amd.require(‘myCarFactory’, function (carObject) {} );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-built_in">require</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>все аргументы, кроме последнего считаются необходимыми зависимостями</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">var</span> depsList = franky.toArray(<span class="hljs-built_in">arguments</span>).slice(<span class="hljs-number">0</span>, <span class="hljs-built_in">arguments</span>.length - <span class="hljs-number">1</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>последний аргумент - функция в которую уйдут удовлетворенные зависимости</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                callback = <span class="hljs-built_in">arguments</span>[<span class="hljs-built_in">arguments</span>.length - <span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>обработка зависимостей</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            depsList = franky.map(depsList, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(depsItem)</span> </span>{
                <span class="hljs-keyword">if</span> (!libs[depsItem]) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Unmet dependency:'</span> + depsItem);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>если модуль представляет из себя синглтон - кешируем его</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (cached[depsItem]) {
                    libs[depsItem] = franky.isFunction(libs[depsItem]) ? libs[depsItem]() : libs[depsItem];
                    <span class="hljs-keyword">return</span> libs[depsItem];
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> libs[depsItem]();
                }
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>пробрасываем удовлетворенные зависимости</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            callback.apply(<span class="hljs-keyword">this</span>, depsList);

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Возвращает “обесшумленную функцию”. Функция будет вызвана после последнего вызова через объявленный таймаут.
Если задан флаг <code>immediate</code>, функция вызовется немедленно, но будет игнорировать вызовы в пределах таймаута.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    franky.debounce = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(func, wait, immediate)</span> </span>{
        <span class="hljs-keyword">var</span> timeout;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">this</span>, args = <span class="hljs-built_in">arguments</span>;
            <span class="hljs-keyword">var</span> later = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                timeout = <span class="hljs-literal">null</span>;
                <span class="hljs-keyword">if</span> (!immediate) {
                    func.apply(context, args);
                }
            };
            <span class="hljs-keyword">var</span> callNow = immediate &amp;&amp; !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            <span class="hljs-keyword">if</span> (callNow) {
                func.apply(context, args);
            }
        };
    };



    franky.amd.define(
        <span class="hljs-string">'statlog'</span>,
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">var</span> root = <span class="hljs-literal">null</span>,
                params = {
                    type: <span class="hljs-string">'show'</span>,
                    root: <span class="hljs-string">'testRoot'</span>,
                    statDataAttr: <span class="hljs-string">'statlog'</span>,
                    dataNoRedirKey: <span class="hljs-string">'statlog-noredir'</span>,
                    doc: <span class="hljs-literal">null</span>,
                    sendAtWill: <span class="hljs-literal">true</span>,
                    dataReadyKey: <span class="hljs-string">'statlog-ready'</span>,
                    clickEvent: <span class="hljs-string">'mousedown'</span>,
                    skipVisibleCheck: <span class="hljs-literal">false</span>,
                    statEnabled: <span class="hljs-literal">false</span>,
                    clickCounter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(path, element)</span> </span>{
                        element = element || <span class="hljs-literal">null</span>;
                        <span class="hljs-built_in">window</span>.cp(getRoot() + <span class="hljs-string">'.'</span> + path, element);
                    }
                },
                getRoot = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> Lego !== <span class="hljs-string">'undefined'</span> &amp;&amp; Lego.params &amp;&amp; Lego.params.statRoot ? Lego.params.statRoot : params.root;
                },
                dumpDATA = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(params)</span> </span>{
                    <span class="hljs-keyword">var</span> res = [];
                    <span class="hljs-keyword">if</span> (root) {
                        res = <span class="hljs-built_in">JSON</span>.stringify({
                            event: params.type,
                            <span class="hljs-string">"parent-path"</span>: getRoot(),
                            blocks: root.children
                        });
                    }
                    <span class="hljs-keyword">return</span> res;
                },
                isEnabled = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> Lego !== <span class="hljs-string">'undefined'</span> &amp;&amp; Lego.params ? Lego.params.statEnabled  : params.statEnabled;
                },
                handleClicks = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>используем делегирование для обработки клика</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(params.doc || <span class="hljs-built_in">document</span>).on(params.clickEvent, <span class="hljs-string">"*[data-"</span> + params.statDataAttr + <span class="hljs-string">"]"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>считаем клики только когда пользователь попадает в выборку</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> (isEnabled()) {
                            <span class="hljs-keyword">var</span> clickPath = $(<span class="hljs-keyword">this</span>).data(params.statDataAttr),
                                notRedirect = $(<span class="hljs-keyword">this</span>).data(params.dataNoRedirKey);

                            <span class="hljs-keyword">if</span> (clickPath) {
                                params.clickCounter(clickPath, notRedirect ? <span class="hljs-literal">null</span> : <span class="hljs-keyword">this</span>);

                                <span class="hljs-keyword">if</span> (notRedirect) {
                                    e.preventDefault();
                                    e.stopPropagation();
                                }
                            }
                        }

                    });
                };

            handleClicks();

            <span class="hljs-keyword">return</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Для того, чтобы сторонние компоненты могли смотреть на настройки - рассказываем о них в инстансе</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                params: params,

                getSingleRequest : <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> </span>{

                    <span class="hljs-keyword">return</span> x.stringf(
                        <span class="hljs-string">'http://clck.yandex.ru/counter/dtype=%s/session_id=%s/events=%s/*'</span>,
                        data.project,
                        data.showId,
                        <span class="hljs-built_in">JSON</span>.stringify([{
                            <span class="hljs-string">"event"</span>: data.event,
                            <span class="hljs-string">"parent-path"</span>: data.path.substr(<span class="hljs-number">0</span>, data.path.lastIndexOf(<span class="hljs-string">'.'</span>)),
                            <span class="hljs-string">"blocks"</span>: [{
                                ctag: data.path.substr(data.path.lastIndexOf(<span class="hljs-string">'.'</span>) + <span class="hljs-number">1</span>)
                            }]
                        }])
                    );
                },
                singleLog: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(statPath)</span> </span>{
                    <span class="hljs-keyword">var</span> url = <span class="hljs-keyword">this</span>.getSingleRequest({
                        project: <span class="hljs-string">'clck'</span>,
                        showId: <span class="hljs-keyword">this</span>.getShowID(),
                        event: <span class="hljs-string">'show'</span>,
                        path: getRoot() + <span class="hljs-string">'.'</span> + statPath
                    });
                    <span class="hljs-keyword">var</span> img = <span class="hljs-keyword">new</span> Image();
                    img.src = url;
                },</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Балковое логирование с использованием CORS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                bulkLog: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**String*/</span>statPath)</span> /**<span class="hljs-title">Object</span>*/ </span>{
                    <span class="hljs-keyword">var</span> current = root ? root : root = {},
                        self = <span class="hljs-keyword">this</span>;

                    franky.forEach(statPath.split(<span class="hljs-string">'.'</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(key)</span> </span>{
                        <span class="hljs-keyword">var</span> existFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(child)</span> </span>{
                            <span class="hljs-keyword">return</span> child.ctag === key;
                        };
                        <span class="hljs-keyword">if</span> (!current.children) {
                            current.children = [];
                        }

                        <span class="hljs-keyword">var</span> tryToGet = franky.filter(current.children, existFunction);
                        <span class="hljs-keyword">if</span> (!tryToGet.length) {
                            current.children.push({
                                ctag: key
                            });
                        }
                        current = franky.filter(current.children, existFunction)[<span class="hljs-number">0</span>];
                    });

                    <span class="hljs-keyword">if</span> (params.sendAtWill) {
                        self.send();
                    }
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
                },</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Логирование счетчика с заданным путем в виде аргумента
e.g. statlog.add(‘v12.head.login’).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                log: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(statPath)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Для браузеров не поддерживающих балковое логирование в виде CORS запроса используем одиночные запросы</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">var</span> logFunc = $.support.cors ? <span class="hljs-keyword">this</span>.bulkLog : <span class="hljs-keyword">this</span>.singleLog;</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>проверяем наличие пути к статистике и флаг логирования</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> statPath !== <span class="hljs-string">'undefined'</span> &amp;&amp; isEnabled()) {
                        <span class="hljs-keyword">return</span> logFunc.call(<span class="hljs-keyword">this</span>, statPath);
                    }
                },</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>добавление счетчиков по результат парсинга куска DOM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                logByDocument: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-comment">/**Object*/</span>p)</span> </span>{

                    <span class="hljs-keyword">var</span> _params = franky.beget(params, p),
                        self = <span class="hljs-keyword">this</span>,
                        attrName = <span class="hljs-string">'data-'</span> + _params.statDataAttr,
                        dataKey = attrName.substr(<span class="hljs-number">5</span>),
                        dataNoRedirKey = dataKey + <span class="hljs-string">'-noredir'</span>,
                        exp =  <span class="hljs-string">"*["</span>+attrName+<span class="hljs-string">"]"</span>,
                        l = _params.doc ? $(_params.doc).find(exp) : $(exp);</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>обходим все элементы с data-statlog - считаем их ‘элементами’ для обсчета статистикой</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    $(l).each(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>проверяем состояние видимости элемента</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">if</span> ($(<span class="hljs-keyword">this</span>).is(<span class="hljs-string">':visible'</span>) || _params.skipVisibleCheck) {
                            <span class="hljs-keyword">if</span> (!attrName.match(<span class="hljs-regexp">/^data-/</span>)) {
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"data attribute expected as statAttr"</span>);
                            }</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>забираем путь к счетчику, считая что это дата-атрибут</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">var</span> dataPath = $(<span class="hljs-keyword">this</span>).data(dataKey);</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Чтобы не считать элемент несколько раз - используем специальный флаг</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                            <span class="hljs-keyword">if</span> (!$(<span class="hljs-keyword">this</span>).data(_params.dataReadyKey)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>складываем в хранилище логера</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                                self.log(dataPath);
                                $(<span class="hljs-keyword">this</span>).data(_params.dataReadyKey, dataPath);
                            }

                        }
                    });
                },</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>дамп залогированных счетчиков</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                dumpDATA: dumpDATA,</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Returns showID as string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                getShowID: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> /**<span class="hljs-title">String</span>*/ </span>{
                    <span class="hljs-keyword">var</span> res = <span class="hljs-string">""</span>;
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> Lego !== <span class="hljs-string">'undefined'</span> &amp;&amp; Lego.params &amp;&amp; Lego.params.msid) {
                        res = Lego.params.msid;
                    }
                    <span class="hljs-keyword">return</span> res;
                },</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Отправка запроса в статистику</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                send: franky.debounce(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                    <span class="hljs-keyword">if</span> (root) {
                        $.ajax({
                            type: <span class="hljs-string">"POST"</span>,
                            url: <span class="hljs-string">"http://clck.yandex.ru/counter/*"</span>,
                            data: {
                                dtype: <span class="hljs-string">"clck"</span>,
                                session_id: <span class="hljs-keyword">this</span>.getShowID(),
                                events: dumpDATA(params)
                            },
                            success: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
                                root = <span class="hljs-literal">null</span>;
                            }
                        });
                    }
                }, <span class="hljs-number">1000</span>)
            };
        }
    );</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Register as a named AMD module</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> define === <span class="hljs-string">"function"</span> &amp;&amp; define.amd ) {
        define( <span class="hljs-string">"franky"</span>, [], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">return</span> franky;
        });
    }
    global.x = global.franky = franky;


    <span class="hljs-keyword">return</span> franky;

}));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
